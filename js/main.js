// Generated by CoffeeScript 1.10.0
(function() {
  var Echelle, ID, Ilet;

  ID = 1;

  Ilet = (function() {
    function Ilet(altitude) {
      this.altitude = altitude;
      this.html = "<div class='spot'>\n    <div class='ilet' data-altitude='" + this.altitude + "'>\n       <span class='info'>" + this.altitude + "</span>       \n    </div>\n    <div class='via' data-denivelle='0'></div>\n</div>";
    }

    return Ilet;

  })();

  Echelle = (function() {
    function Echelle(hauteur) {
      this.hauteur = hauteur;
      this.html = "<div class='echelle' data-hauteur='" + this.hauteur + "'>\n  <span class='info'>" + this.hauteur + "</span>\n</div>";
    }

    return Echelle;

  })();

  $(function() {
    var checkit, echelle, echelles, height, i, ilet, ilets, j, k, len, len1;
    ilets = [1, 2, 3, 4, 5, 8, 9, 10];
    echelles = [1, 3, 4, 5, 6, 7, 8];
    for (j = 0, len = ilets.length; j < len; j++) {
      i = ilets[j];
      ilet = new Ilet(i);
      height = 50 * i;
      $("#mafate").append(ilet.html);
      $(".ilet[data-altitude='" + ilet.altitude + "']").css({
        'height': height + "px"
      });
    }
    for (k = 0, len1 = echelles.length; k < len1; k++) {
      i = echelles[k];
      echelle = new Echelle(i);
      height = 50 * i;
      $("#echelles").append(echelle.html);
      $(".echelle[data-hauteur='" + echelle.hauteur + "']").css({
        'height': height + "px"
      });
    }
    checkit = function() {
      var blues;
      $(".echelle").removeClass("shine-right shine-wrong");
      $(".spot").each(function() {
        var bottom, current_alt, d, next_alt, via;
        via = $(this).find(".via").show();
        if ($(this).next(".spot").length) {
          current_alt = parseInt($(this).find(".ilet").attr("data-altitude"));
          next_alt = parseInt($(this).next(".spot").find(".ilet").attr("data-altitude"));
          d = current_alt - next_alt;
          height = (Math.abs(d)) + "0%";
          if (d > 0) {
            bottom = next_alt + "0%";
          } else {
            bottom = current_alt + "0%";
          }
          via.attr("data-denivelle", d).css({
            'height': height,
            'bottom': bottom,
            'bottom': bottom
          });
          echelle = parseInt(via.find(".echelle").attr("data-hauteur"));
          if (echelle !== Math.abs(current_alt - next_alt)) {
            return via.find(".echelle").addClass("shine-wrong");
          } else {
            return via.find(".echelle").addClass("shine-right");
          }
        }
      });
      $(".spot").last().find(".echelle").appendTo("#echelles");
      $(".spot").last().find(".via").hide();
      blues = $(".shine-right").length;
      echelles = $(".echelle").length;
      if (echelles === blues) {
        return alert("gagn√© !");
      }
    };
    checkit();
    $("#mafate").sortable({
      stop: function() {
        return checkit();
      }
    });
    $("#echelles").draggable();
    $(".echelle").draggable();
    return $(".via").droppable({
      tolerance: 'touch',
      accept: '.echelle',
      activeClass: "shine-yellow",
      hoverClass: "shine-white",
      drop: function(event, ui) {
        $(this).append(ui.draggable);
        ui.draggable.css({
          left: 0,
          top: 0
        });
        return checkit();
      }
    });
  });

}).call(this);
